<!DOCTYPE html><html lang="en"><head><meta charset="utf-8" /><title>: Gradle Build Tool</title><meta content="yes" name="apple-mobile-web-app-capable" /><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style" /><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui" name="viewport" /><link href="reveal.js/css/reveal.css" rel="stylesheet" /><link rel="stylesheet" href="reveal.js/css/theme/gradle.css" id="theme" /><!--This CSS is generated by the Asciidoctor-Reveal.js converter to further integrate AsciiDoc's existing semantic with Reveal.js--><style type="text/css">.reveal div.right {
  float: right;
}

/* callouts */
.conum[data-value] {display:inline-block;color:#fff!important;background-color:rgba(50,150,50,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]:after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}</style><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.3.0/css/font-awesome.min.css" /><link href="reveal.js/lib/css/zenburn.css" rel="stylesheet" /><script>var link = document.createElement( 'link' );
link.rel = 'stylesheet';
link.type = 'text/css';
link.href = window.location.search.match( /print-pdf/gi ) ? "reveal.js/css/print/pdf.css" : "reveal.js/css/print/paper.css";
document.getElementsByTagName( 'head' )[0].appendChild( link );</script><!--[if lt IE 9]><script src="reveal.js/lib/js/html5shiv.js"></script><![endif]-->
<link rel="stylesheet" type="text/css" href="reveal.js/css/theme/asciinema-player.css" />
<link rel="stylesheet" type="text/css" href="reveal.js/css/theme/asciinema-theme-gradle.css" />
<link rel="stylesheet" type="text/css" href="reveal.js/css/theme/github-gist.css" />
<script src="reveal.js/css/theme/asciinema-player.js"></script></head><body><div class="reveal"><div class="slides"><section class="title" data-state="title" data-transition="zoom" data-transition-speed="fast" data-background-image="./images/title.jpeg"><h1></h1><h2>Gradle Build Tool</h2><div class="preamble"><div class="paragraph"><p><h2>
Pièges et bonnes pratiques
</h2></p></div>
<div class="paragraph"><p>Paul Merlin (@eskat0s) - Gradle Inc.</p></div></div></section>
<section id="qui-suis-je"><h2>Qui suis-je ?</h2><pre class="highlight listingblock"><code data-noescape="" class="kotlin language-kotlin">speaker {
    name = "Paul Merlin"
    company = "Gradle Inc."
    locations = setOf("Montpellier, France", "Cevennes &lt;3")
    oss  = "Apache Polygene PMC, former chair"
    successes = listOf(
        "BASIC 'Hello, World!' in 1986",
        "C 'Hello, World!' in 1989",
        "Java 'Hello, World!' in 1996"
        "Kotlin 'Hello, World!' in 2015",
        "tools", "daemons", "apps", "frameworks", "libs"
    ),
    failures = generateSequence(code) { bugs },
    twitter = "@eskat0s",
    github = "eskatos"
}</code></pre></section>
<section id="qui-êtes-vous"><h2>Qui êtes-vous ?</h2><div class="ulist"><ul><li><p>Qui construit pour la JVM ?</p></li><li><p>Qui construit pour les VM JavaScript ?</p></li><li><p>Qui construit du natif ?</p></li><li><p>Autre chose ? Quoi ?</p></li><li><p>Qui se sert uniquement de Gradle au boulot ?</p></li><li><p>Qui se sert uniquement de Maven au boulot ?</p></li><li><p>Qui se sert des deux au boulot ?</p></li><li><p>Qui se sert d&#8217;autres outils de build ? lesquels ?</p></li><li><p>Qui a déjà modifié/écrit un build Gradle ?</p></li></ul></div></section>
<section id="agenda" data-background-color="#02303A"><h2>Agenda</h2><div class="ulist"><ul><li><p>Gradle, c&#8217;est quoi ?</p></li><li><p>Comment on s&#8217;en sert ?</p></li><li><p>Basique!</p></li><li><p>En pratique</p></li><li><p>Organiser la logique de build</p></li><li><p>Des builds performants</p></li><li><p>Maintenir et faire évoluer des builds</p></li><li><p>Intégration continue</p></li></ul></div></section>
<section><section id="gradle-c-est-quoi" data-background-color="#02303A"><h2>Gradle, c&#8217;est quoi ?</h2></section><section id="gradle-c-est-quoi-2"><h2>Gradle, c&#8217;est quoi ?</h2><div class="paragraph"><p>Gradle est un outil de construction et d&#8217;automatisation.</p></div>
<div class="ulist"><ul><li><p>Gradle Build Tool</p></li><li><p>Tourne sur une JVM</p></li><li><p>Implémenté en Java</p></li><li><p>Apache License 2.0</p></li></ul></div></section><section id="agnostique-de-l-écosystème"><h2>Agnostique de l&#8217;écosystème</h2><div class="ulist"><ul><li><p>Écosystème JVM</p><div class="ulist"><ul><li><p>Java, Kotlin, Groovy, Scala, Clojure &#8230;&#8203;</p></li></ul></div></li><li><p>Écosystème natif</p><div class="ulist"><ul><li><p>C, C++, Swift, &#8230;&#8203;</p></li></ul></div></li><li><p>Android</p></li><li><p>Et bien d&#8217;autres</p><div class="ulist"><ul><li><p>JavaScript, Python, Go, Rust, Asciidoctor, Docker &#8230;&#8203;</p></li></ul></div></li></ul></div></section><section id="gradle-en-quelques-chiffres"><h2>Gradle en quelques chiffres</h2><div class="ulist"><ul><li><p>&gt;7.0M téléchargements par mois</p></li><li><p><a href="https://techcrunch.com/2017/04/07/tracking-the-explosive-growth-of-open-source-software/">#17 Projet Open Source</a></p></li><li><p>35+ ingénieurs Gradle</p></li><li><p>300K constructions par semaine @LinkedIn</p></li></ul></div></section><section id="gradle-inc"><h2>Gradle Inc.</h2><div class="paragraph"><p>La compagnie derrière Gradle.</p></div>
<div class="ulist"><ul><li><p>"Build Happiness"</p></li><li><p>Emploie des ingénieurs à plein temps</p></li><li><p>Produit aussi Gradle Enterprise</p></li><li><p>(Gradle consulting, support, service etc.)</p></li><li><p>(Training: online, public and in-house)</p></li></ul></div></section><section id="gradle-enterprise"><h2>Gradle Enterprise</h2><div class="ulist"><ul><li><p>Produit commercial - Productivité des développeurs</p></li><li><p><strong>Build Scans</strong></p><div class="ulist"><ul><li><p>enregistrement persistent et partageable</p></li><li><p>de ce qui s&#8217;est passé pendant un build</p></li></ul></div></li><li><p><strong>Build Cache</strong></p><div class="ulist"><ul><li><p>réutilisation des outputs de build</p></li></ul></div></li><li><p>Installation sur site, cache distribué, historique des constructions, dashboards, export API etc&#8230;&#8203;</p></li></ul></div></section><section id="gradle-enterprise-2"><h2>Gradle Enterprise</h2><div class="imageblock" style=""><img src="./images/gradle-enterprise.png" alt="gradle enterprise" width="80%" height="80%" /></div></section><section id="build-scans-gratuits-en-saas"><h2>Build Scans gratuits en SaaS</h2><div class="ulist"><ul><li><p><a href="https://scans.gradle.com/">scans.gradle.com</a></p></li><li><p>Déjà utilisé par plein de projets open-source</p></li><li><p><code>gradle --scan</code></p></li></ul></div></section><section id="et-le-build-cache"><h2>Et le Build Cache ?</h2><div class="ulist"><ul><li><p>Le Build Cache local est intégré à Gradle en Open Source</p><div class="ulist"><ul><li><p><a href="https://docs.gradle.org/current/userguide/build_cache.html"><code>gradle --build-cache</code></a></p></li></ul></div></li><li><p>Image docker d&#8217;un noeud de service Build Cache, non distribué</p><div class="ulist"><ul><li><p><a href="https://docs.gradle.com/build-cache-node/"><code>gradle/build-cache-node:latest</code></a></p></li></ul></div></li></ul></div></section><section id="gradle-recrute"><h2>Gradle recrute!</h2><div class="ulist"><ul><li><p>Une équipe de développement totalement distribuée</p></li><li><p>Un projet intéressant utilisé par des millions</p></li><li><p>Des positions dans l&#8217;équipe Build Tool et Gradle Enterprise</p></li></ul></div>
<div class="paragraph"><p>Si ce qui suit est un problème intéressant à résoudre à vos yeux,</p></div>
<div class="ulist"><ul><li><p><a href="https://gradle.com/careers/" class="bare">https://gradle.com/careers/</a></p></li><li><p>ou parlez moi à la pause :-)</p></li></ul></div></section></section>
<section><section id="comment-se-sert-on-de-gradle" data-background-color="#02303A"><h2>Comment se sert-on de Gradle ?</h2></section><section id="comment-se-sert-on-de-gradle-2"><h2>Comment se sert-on de Gradle ?</h2><div class="ulist"><ul><li><p>en ligne de commande</p></li><li><p>en intégration continue</p></li><li><p>depuis un IDE</p></li><li><p>via une API</p></li></ul></div></section><section id="code-gradle-build-code"><h2><code>gradle build</code></h2><div class="ulist"><ul><li><p>Gradle est avant tout un <strong>outil en ligne de commande</strong></p></li><li><p><code>USAGE: gradle [option&#8230;&#8203;] [task&#8230;&#8203;]</code></p></li><li><p>Un client qui démarre et réutilise un démon</p><div class="ulist"><ul><li><p>performance: JVM JIT &amp; caches mémoire</p></li></ul></div></li><li><p>Un wrapper enregistré dans le dépôt de sources</p><div class="ulist"><ul><li><p>Version de l&#8217;outil de construction fixée</p></li><li><p>Pas besoin d&#8217;installation, seulement d&#8217;une JVM</p></li><li><p><code>git clone foo &amp;&amp; cd foo &amp;&amp; ./gradlew build</code></p></li></ul></div></li></ul></div></section><section id="intégration-continue"><h2>Intégration Continue</h2><div class="paragraph"><p>Les services d&#8217;intégration continue executent Gradle, tout simplement.
Certains d&#8217;entre eux fournissent des fonctionnalités supplémentaires en consommant les résulats de construction:</p></div>
<div class="ulist"><ul><li><p>sortie console,</p></li><li><p>résultats d&#8217;execution de tests (xUnit, coverage etc..),</p></li><li><p>URL du Build Scan,</p></li><li><p>etc &#8230;&#8203;</p></li></ul></div>
<div class="paragraph"><p>Quelques guides pour <a href="https://guides.gradle.org/executing-gradle-builds-on-jenkins/">Jenkins</a>, <a href="https://guides.gradle.org/executing-gradle-builds-on-travisci/">Travis</a>, <a href="https://guides.gradle.org/executing-gradle-builds-on-teamcity/">TeamCity</a>.</p></div></section><section id="ide-gradle"><h2>IDE &#8658; Gradle</h2><div class="ulist"><ul><li><p>Certains IDEs supportent Gradle nativement</p></li><li><p>On importe un build Gradle directement dans l&#8217;IDE</p><div class="ulist"><ul><li><p>IntelliJ IDEA, CLion, Eclipse, Netbeans</p></li><li><p>mais aussi les Language Servers (LSP)</p></li></ul></div></li><li><p>L&#8217;IDE interroge Gradle pour obtenir le modèle du build</p><div class="ulist"><ul><li><p>les sets de sources, leurs dépendances etc..</p></li><li><p>les tâches disponibles</p></li><li><p>la configuration de l&#8217;IDE</p></li></ul></div></li></ul></div></section><section id="gradle-ide"><h2>Gradle &#8658; IDE</h2><div class="paragraph"><p>Pour d&#8217;autres IDE qui ne fonctionnent qu&#8217;à partir de fichiers de configuration, Gradle peut générer ceux-ci.</p></div>
<div class="ulist"><ul><li><p>IntelliJ IDEA et Eclipse (déprécié en faveur de l&#8217;import)</p></li><li><p>Visual Studio</p></li><li><p>XCode</p></li></ul></div></section><section id="le-build-configure-l-ide"><h2>Le build configure l&#8217;IDE</h2><div class="paragraph"><p>Dans tous les cas, l&#8217;objectif est de configurer l&#8217;IDE</p></div>
<div class="ulist"><ul><li><p>depuis le build</p></li><li><p>depuis le dépôt de sources</p></li><li><p>pour tout le monde pareil</p></li><li><p>sans configuration manuelle</p></li></ul></div></section><section id="tooling-api"><h2>Tooling API</h2><div class="paragraph"><p>Il est également possible de piloter Gradle via une api, la Tooling API.</p></div>
<div class="paragraph"><p>C&#8217;est ce que les IDE permettant l&#8217;import de builds Gradle utilisent.</p></div>
<div class="paragraph"><p><a href="https://docs.gradle.org/current/userguide/embedding.html">docs.gradle.org/current/userguide/embedding.html</a></p></div></section></section>
<section><section id="gradle-les-bases" data-background-color="#02303A"><h2>Gradle, les bases</h2></section><section id="gradle-les-bases-2"><h2>Gradle, les bases</h2><div class="ulist"><ul><li><p>Scripts de build en Kotlin et Groovy</p></li><li><p>Configuration et execution de tâches</p></li><li><p>Résolution de dépendances</p></li><li><p>Éviter le répéter travail</p></li></ul></div>
<div class="imageblock" style=""><img src="./images/gradle-task-dag.png" alt="gradle task dag" width="1280" height="350px" /></div></section><section id="gradle-plugins" data-transition="none"><h2>Gradle Plugins</h2><div class="ulist"><ul><li><p>Core Plugins (<code>java</code>, <code>jacoco</code>, <code>maven-publish</code> &#8230;&#8203;)</p></li><li><p>Community Plugins (<code>kotlin</code>, <code>android</code>, <code>golang</code>, <code>docker</code>, <code>asciidoctor</code> &#8230;&#8203;)</p></li></ul></div>
<div class="imageblock" style=""><img src="./images/gradle-task-dag.png" alt="gradle task dag" width="1280" height="350px" /></div></section><section id="gradle-plugins-2" data-transition="none"><h2>Gradle Plugins</h2><div class="ulist"><ul><li><p>Des plugins Gradle contribuent</p><div class="ulist"><ul><li><p>des tâches configurables et réutilisables</p></li><li><p>des extensions Gradle configurables</p></li></ul></div></li></ul></div>
<div class="imageblock" style=""><img src="./images/gradle-task-dag.png" alt="gradle task dag" width="1280" height="350px" /></div></section><section id="gradle-plugins-3" data-transition="none"><h2>Gradle Plugins</h2><div class="ulist"><ul><li><p>Des plugins Gradle contribuent <strong>un modèle à configurer</strong></p><div class="ulist"><ul><li><p>dans les scripts de build</p></li><li><p>en utilisant un DSL</p></li></ul></div></li></ul></div>
<div class="imageblock" style=""><img src="./images/gradle-task-dag.png" alt="gradle task dag" width="1280" height="350px" /></div></section><section id="une-librairie-java"><h2>Une librairie Java</h2><pre class="highlight listingblock"><code data-noescape="" class="groovy language-groovy">plugins {
   `java-library`
}

dependencies {
   api("com.acme:foo:1.0")
   implementation("com.zoo:monkey:1.1")
}

tasks.withType&lt;JavaCompile&gt; {
    // ...
}</code></pre></section><section id="une-application-c"><h2>Une application C++</h2><pre class="highlight listingblock"><code data-noescape="" class="groovy language-groovy">plugins {
    `cpp-application`
}

application {
    baseName = "my-app"
}

toolChains {
    // ...
}</code></pre></section><section id="Éviter-de-répéter-le-travail"><h2>Éviter de répéter le travail</h2><div class="ulist"><ul><li><p>Unités de travail: tâches, transformations</p></li><li><p><code>@Input*</code></p></li><li><p><code>@Output*</code></p></li><li><p><code>UP_TO_DATE</code> - Build Incrémental</p><div class="ulist"><ul><li><p>Les inputs n&#8217;ont pas changé, les outputs sont présents et inchangés</p></li></ul></div></li><li><p><code>FROM_CACHE</code> - Build Cache</p><div class="ulist"><ul><li><p>Les inputs n&#8217;ont pas changé, les outputs ont été rapatrié depuis le cache</p></li></ul></div></li></ul></div></section></section>
<section><section id="en-pratique" data-background-color="#02303A"><h2>En pratique</h2></section><section id="en-pratique-2"><h2>En pratique</h2><div class="ulist"><ul><li><p>Hello, Gradle World!</p></li><li><p>Un petit build</p></li><li><p>Un gros build</p></li><li><p>Plein de builds</p></li></ul></div></section><section id="créer-un-nouveau-build"><h2>Créer un nouveau build</h2><div class="ulist"><ul><li><p>Avec Gradle installé</p><div class="ulist"><ul><li><p><code>gradle init</code></p></li></ul></div></li><li><p>Depuis une interface Web</p><div class="ulist"><ul><li><p><a href="https://gradle-initializr.cleverapps.io/" class="bare">https://gradle-initializr.cleverapps.io/</a></p></li></ul></div></li></ul></div></section><section id="code-gradle-init-code"><h2><code>gradle init</code></h2><div class="paragraph"><p><asciinema-player src="/hello-gradle.cast" class="stretch" theme="gradle"></asciinema-player></p></div></section><section id="un-petit-build" data-background-color="#02303A"><h2>Un petit build</h2><h level="3">DEMO</h><aside class="notes"><div class="ulist"><ul><li><p><code>plugins { base }</code></p><div class="ulist"><ul><li><p>Tâches</p><div class="ulist"><ul><li><p><code>gradle tasks</code></p></li><li><p><code>gradle help --task &lt;taskName&gt;</code></p></li></ul></div></li><li><p>Extensions</p></li></ul></div></li><li><p>cycle de vie du build</p></li><li><p>configuration vs. execution</p></li></ul></div></aside></section><section id="un-petit-build-2"><h2>Un petit build</h2><div class="ulist"><ul><li><p>Un seul projet</p></li><li><p>Les plugins contribuent un modèle qui se configure via le DSL</p></li><li><p>Configuration vs. Execution</p></li></ul></div></section><section id="configuration-vs-execution"><h2>Configuration vs. Execution</h2><div class="imageblock" style=""><img src="./images/itsatrap.jpg" alt="itsatrap" width="75%" height="75%" /></div></section><section id="un-gros-build" data-background-color="#02303A"><h2>Un gros build</h2><h level="3">DEMO</h><aside class="notes"><div class="ulist"><ul><li><p>Multi-projets</p><div class="ulist"><ul><li><p>Settings</p></li><li><p>Hiérarchie de projets</p></li><li><p>Cycle de vie du build</p></li><li><p>Projet racine</p></li></ul></div></li></ul></div></aside></section><section id="un-gros-build-2"><h2>Un gros build</h2><div class="ulist"><ul><li><p>Multi-projets</p><div class="ulist"><ul><li><p>3 dans notre exemple</p></li><li><p>10 à 100, raisonnable et fréquent</p></li><li><p>500 et plus, moins fréquent mais ça existe</p></li></ul></div></li><li><p>Hiérachie de projets</p><div class="ulist"><ul><li><p>Configuration</p></li><li><p>Configurer les sous-projets</p></li></ul></div></li></ul></div></section><section id="plein-de-builds" data-background-color="#02303A"><h2>Plein de builds</h2></section><section id="plein-de-builds-2"><h2>Plein de builds</h2><div class="ulist"><ul><li><p>Séparer un gros build en plusieurs petits</p></li><li><p>Différentes équipes, cycle de livraison différent etc&#8230;&#8203;</p></li><li><p>Mono-repo vs. Multi-repo</p></li></ul></div></section><section id="plein-de-builds-3" data-background-color="#02303A"><h2>Plein de builds</h2><h level="3">DEMO</h></section><section id="plein-de-builds-4"><h2>Plein de builds</h2><div class="ulist"><ul><li><p>Settings</p></li><li><p>Composite Builds - Included Builds</p><div class="ulist"><ul><li><p>Fini les <code>-SNAPSHOTS</code> !</p></li><li><p>Utiles aussi pour travailler sur des librairies externes</p></li><li><p>Augmente/Limite le scope disponible dans l&#8217;IDE</p></li></ul></div></li><li><p>Source Dependencies</p><div class="ulist"><ul><li><p>Dépendre d&#8217;un dépôt git distant</p></li><li><p>Librairie ou fix non publié</p></li><li><p>Sources non modifiables</p></li></ul></div></li></ul></div></section><section id="en-pratique-3"><h2>En pratique</h2><div class="ulist"><ul><li><p>Pas de logique de build commune</p></li><li><p>Pas de réutilisation</p></li><li><p>Comment organiser sa logique de build ?</p></li></ul></div></section></section>
<section><section id="organiser-la-logique-de-build" data-background-color="#02303A"><h2>Organiser la logique de build</h2></section><section id="organiser-la-logique-de-build-2"><h2>Organiser la logique de build</h2><div class="ulist"><ul><li><p>organiser la logique de build</p><div class="ulist"><ul><li><p>un build, une hierarchie de projets</p></li><li><p>settings</p></li><li><p>buildSrc</p></li><li><p>init scripts</p></li></ul></div></li><li><p>extraire une convention</p><div class="ulist"><ul><li><p>vers le projet racine</p></li><li><p>vers un plugin dans buildSrc</p></li><li><p>modeler le DSL (extension &amp; configuration de tâches)</p></li></ul></div></li><li><p>tester la logique de build</p><div class="ulist"><ul><li><p>buildSrc</p></li><li><p>ProjectBuilder / TestKit</p></li></ul></div></li><li><p>partager la logique de build</p><div class="ulist"><ul><li><p>extraire dans un autre build</p></li><li><p>publier</p></li></ul></div></li><li><p>composite builds</p><div class="ulist"><ul><li><p>mono-repo vs. multi-repo</p></li><li><p>mono-build vs. multi-builds</p></li><li><p>included build</p></li><li><p>included build logic</p></li></ul></div></li></ul></div></section></section>
<section id="interlude" data-background-color="#02303A"><h2>Interlude</h2></section>
<section><section id="pfiouuuuu" data-background-color="#02303A"><h2>Pfiouuuuu</h2></section><section id="pfiouuuuu-2"><h2>Pfiouuuuu</h2><div class="paragraph"><p>Mais, j&#8217;ai déjà assez à faire avec le code de production! et c&#8217;est sans compter les tests unitaires, d&#8217;intégration, fonctionnels, bariolés &#8230;&#8203;</p></div>
<div class="paragraph"><p>OUI &#8230;&#8203; MAIS</p></div>
<div class="ulist"><ul><li><p>Qui doit s&#8217;occuper du build ?</p></li><li><p>Qui se sert du build ?</p><div class="ulist"><ul><li><p>Tout le monde</p></li><li><p><code>@dev</code>, <code>@ide</code>, <code>@ci</code>, <code>@qa</code>, <code>@ops</code> etc&#8230;&#8203;</p></li><li><p>Le produit du build c&#8217;est ce qui va en prod</p></li><li><p>&#8658; <code>@users</code></p></li></ul></div></li></ul></div></section><section id="pfiouuuuuu"><h2>Pfiouuuuuu</h2><div class="paragraph"><p>Qui doit s&#8217;occuper du build ?</p></div>
<div class="ulist"><ul><li><p>Projet solo</p><div class="ulist"><ul><li><p>C&#8217;est bibi !</p></li></ul></div></li><li><p>Projet en équipe(s)</p><div class="ulist"><ul><li><p>Tout le monde, éventuellement un build-master/team</p></li></ul></div></li><li><p>Grandes organisations</p><div class="ulist"><ul><li><p>Idéalement un build-master ou une build-team, pour l&#8217;uniformité et la réutilisation</p></li></ul></div></li><li><p>YMMV - Mais il faut s&#8217;en occuper</p></li></ul></div></section><section id="pfiouuuuuu-2"><h2>Pfiouuuuuu</h2><div class="paragraph"><p>Et puis &#8230;&#8203;</p></div>
<div class="ulist"><ul><li><p>Je peux automatiser n&#8217;importe quoi</p><div class="ulist"><ul><li><p>Générer des trucs et des machins</p></li><li><p>Les envoyer dans les nuages</p></li><li><p>Interagir avec des APIs</p></li><li><p>Déployer sur les ordinateurs d&#8217;un autre (aka. le Cloug™)</p></li></ul></div></li><li><p>Le build c&#8217;est aussi un bon moyen de rapprocher les Devs des Ops (hein?)</p></li></ul></div></section><section id="pfiouuuuuu-3" data-transition="none" data-background-image="./images/troll.jpg"><h2>Pfiouuuuuu</h2><div class="paragraph"><p>Et puis &#8230;&#8203;</p></div>
<div class="ulist"><ul><li><p>Je peux automatiser n&#8217;importe quoi</p><div class="ulist"><ul><li><p>Générer des trucs et des machins</p></li><li><p>Les envoyer dans les nuages</p></li><li><p>Interagir avec des APIs</p></li><li><p>Déployer sur les ordinateurs d&#8217;un autre (aka. le Cloug™)</p></li></ul></div></li><li><p>Le build c&#8217;est aussi un bon moyen de rapprocher les Devs des Ops (hein?)</p></li></ul></div></section><section id="pfiouuuuuu-4"><h2>Pfiouuuuuu</h2><div class="ulist"><ul><li><p>Le build c&#8217;est un peu comme les tests</p></li><li><p>S&#8217;en occuper, c&#8217;est rendre service à son futur soi/utilisateur</p></li><li><p>Si le build est bien fait et testé</p><div class="ulist"><ul><li><p>Je peux le faire évoluer facilement</p></li><li><p>Je ne le casse pas sans m&#8217;en rendre compte</p></li></ul></div></li><li><p>Si le build est maintenu performant, je ne perds pas de temps</p></li></ul></div></section></section>
<section><section id="des-builds-performants" data-background-color="#02303A"><h2>Des builds performants</h2></section><section id="des-builds-performants-2"><h2>Des builds performants</h2><div class="imageblock" style=""><img src="./images/compiling.png" alt="compiling" width="50%" height="50%" /></div>
<div class="paragraph"><p>Tout le monde veut un build qui va vite™</p></div></section><section id="avant-tout"><h2>Avant tout</h2><div class="ulist"><ul><li><p>Utilisez les dernières version de JVM et de Gradle</p></li><li><p>Donnez assez de mémoire à Gradle</p></li><li><p>Le tuning de JVM et ses flags obscurs font souvent plus de mal qu&#8217;autre chose</p></li><li><p>Prenez plutôt le temps de faire des améliorations structurelles</p></li><li><p>Activez <code>--parallel</code> (<code>org.gradle.parallel=true</code>)</p></li><li><p>Activez <code>--build-cache</code> (<code>org.gradle.caching=true</code>)</p></li></ul></div></section><section id="mesurer-fixer-mesurer"><h2>Mesurer, fixer, mesurer &#8230;&#8203;</h2><div class="paragraph"><p>Ou comment ne pas optimiser à l&#8217;aveugle</p></div>
<div class="ulist"><ul><li><p>Identifiez vos cas d&#8217;utilisation</p></li><li><p>Automatiser vos mesures</p></li><li><p>Identifiez le goulet d&#8217;étranglement principal</p></li><li><p>Fixez le goulet</p></li><li><p>Vérifiez le fix en mesurant de nouveau</p></li><li><p>Répéter</p></li></ul></div></section><section id="automatisez-vos-mesures"><h2>Automatisez vos mesures</h2><div class="paragraph"><p><a href="https://github.com/gradle/gradle-profiler">github.com/gradle/gradle-profiler</a></p></div>
<pre class="highlight listingblock"><code data-noescape="">configurationTime {
    tasks = ["help"]
}
cleanBuild {
    tasks = ["build"]
    cleanup-tasks = ["clean"]
}
cachedCleanBuild {
    tasks = ["build"]
    cleanup-tasks = ["clean"]
    gradle-args = ["--build-cache"]
}</code></pre></section><section id="où-est-le-problème"><h2>Où est le problème ?</h2><div class="ulist"><ul><li><p>Commencez par observer un build</p><div class="ulist"><ul><li><p><code>gradle --scan</code> ou <code>gradle --profile</code></p></li></ul></div></li></ul></div>
<div class="imageblock" style=""><img src="./images/blank.png" alt="blank" width="60%" height="60%" /></div></section><section id="où-est-le-problème-2"><h2>Où est le problème ?</h2><div class="ulist"><ul><li><p>Commencez par observer un build</p><div class="ulist"><ul><li><p><code>gradle --scan</code> ou <code>gradle --profile</code></p></li></ul></div></li></ul></div>
<div class="imageblock" style=""><img src="./images/lifecycle.png" alt="lifecycle" width="60%" height="60%" /></div></section><section id="signes-évidents-de-problèmes"><h2>Signes évidents de problèmes</h2><div class="ulist"><ul><li><p>Startup/buildSrc/Settings &gt; 1s</p></li><li><p>Temps de configuration &gt; 10ms/projet</p></li><li><p>Changer une ligne de code ~= <code>clean build</code></p></li><li><p>Un build censé être un NO-OP qui fait quelque chose</p></li><li><p>Long temps de GC (Garbage Collection)</p></li></ul></div></section><section id="optimiser-la-configuration"><h2>Optimiser la configuration</h2><div class="ulist"><ul><li><p>Quoi ?</p><div class="ulist"><ul><li><p>Application les plugins</p></li><li><p>Evaluation les scripts de build</p></li><li><p>Execution les callbacks (e.g. <code>afterEvaluate {}</code>)</p></li></ul></div></li><li><p>Quand ?</p><div class="ulist"><ul><li><p><code>gradle help</code> ou <code>gradle tasks</code></p></li><li><p>Synchronisation d&#8217;un IDE</p></li><li><p>à chaque invocation, c&#8217;est un coût fixe!</p></li></ul></div></li></ul></div></section><section id="optimiser-la-configuration-2"><h2>Optimiser la configuration</h2><div class="paragraph"><p>Principales causes de lenteur</p></div>
<div class="ulist"><ul><li><p>Résolution de dépendances à la configuration</p></li><li><p>I/O à la configuration</p></li><li><p>Plugins inefficaces</p></li><li><p>Logique répetée</p></li></ul></div></section><section id="optimiser-la-configuration-3" data-background-color="#02303A"><h2>Optimiser la configuration</h2><div class="paragraph"><p>En pratique!</p></div></section><section id="optimiser-la-configuration-4"><h2>Optimiser la configuration</h2><div class="paragraph"><p>Conseils structurels</p></div>
<div class="ulist"><ul><li><p>utilisez <code>buildSrc</code></p></li><li><p>compilez statiquement votre logique de build</p></li><li><p>gardez vos scripts de build déclaratifs</p></li></ul></div></section><section id="optimiser-la-configuration-5"><h2>Optimiser la configuration</h2><div class="paragraph"><p>Optimisez les algorithmes</p></div>
<div class="imageblock" style=""><img src="./images/flames.png" alt="flames" width="80%" height="80%" /></div>
<div class="paragraph"><p><code>gradle-profiler --profile async-profiler</code></p></div></section><section id="optimiser-l-execution"><h2>Optimiser l&#8217;execution</h2><div class="ulist"><ul><li><p>Execution des tâches</p><div class="ulist"><ul><li><p>UP_TO_DATE</p></li><li><p>FROM_CACHE</p></li><li><p>Incremental inputs</p></li><li><p>Parallélisme et Worker API</p></li></ul></div></li></ul></div></section><section id="builds-incrémentaux"><h2>Builds incrémentaux</h2><div class="imageblock" style=""><img src="./images/perf-incremental.png" alt="perf incremental" width="80%" height="80%" /></div>
<div class="paragraph"><p>Si rien n&#8217;a changé, <strong>aucune</strong> tâche ne devrait être executée</p></div></section><section id="builds-incrémentaux-2"><h2>Builds incrémentaux</h2><div class="imageblock" style=""><img src="./images/perf-volatile-inputs.png" alt="perf volatile inputs" width="80%" height="80%" /></div>
<div class="paragraph"><p>Trouvez les inputs volatiles</p></div></section><section id="uuid-anyone"><h2>UUID anyone?</h2><pre class="highlight listingblock"><code data-noescape="" class="kotlin language-kotlin">tasks.jar {
    manifest {
        attribute("Build-ID", UUID.randomUUID().toString())
    }
}</code></pre>
<div class="paragraph"><p>Les identifiants uniques ou timestamps sont à proscrire pour des builds reproductibles et performants!</p></div></section><section id="gradle-build-cache"><h2>Gradle Build Cache</h2><div class="paragraph"><p>TDB</p></div>
<div class="ulist"><ul><li><p>Traps!</p><div class="ulist"><ul><li><p>inputs volatiles (identifiants uniques, timestamps, ordre non stable)</p></li><li><p>chemins absolus</p></li><li><p>line separators</p></li></ul></div></li></ul></div></section><section id="execution-parallèle"><h2>Execution parallèle</h2><div class="paragraph"><p>Éxecution sérielle</p></div>
<div class="imageblock" style=""><img src="./images/perf-serial.png" alt="perf serial" width="80%" height="80%" /></div>
<div class="paragraph"><p>Éxecution parallèle</p></div>
<div class="imageblock" style=""><img src="./images/perf-parallel.png" alt="perf parallel" width="80%" height="80%" /></div></section><section id="compilation-plus-rapide"><h2>Compilation plus rapide</h2><div class="ulist"><ul><li><p>Modularisation</p><div class="ulist"><ul><li><p>&#8658; Compilation avoidance on non-abi change</p></li><li><p>&#8658; Parallélisation</p></li></ul></div></li><li><p>Code découplé</p><div class="ulist"><ul><li><p>&#8658; Compilation incrémentale plus efficace</p></li></ul></div></li><li><p>Processeurs d&#8217;annotations</p><div class="ulist"><ul><li><p>&#8658; Vérifiez bien qu&#8217;ils soient incrémentaux</p></li></ul></div></li></ul></div></section><section id="résolution-de-dépendances"><h2>Résolution de dépendances</h2><div class="ulist"><ul><li><p>Dynamic versions &amp; locking</p></li><li><p>Repositories</p><div class="ulist"><ul><li><p>As few as possible</p></li><li><p>Filtering repositories content</p></li><li><p>no <code>mavenLocal()</code></p></li></ul></div></li></ul></div></section><section id="surveiller-la-performance-du-build"><h2>Surveiller la performance du build</h2><div class="ulist"><ul><li><p>Pour qu&#8217;elle ne regresse pas</p></li><li><p>L&#8217;intégration continue peut alerter, voir fournir des tabeaux de bords</p></li><li><p>Gradle Enterprise fourni des solutions dédiées à la gestion de la performance du build</p></li></ul></div>
<div class="imageblock" style=""><img src="./images/perf-dashboard.png" alt="perf dashboard" width="80%" height="80%" /></div></section></section>
<section><section id="maintenir-et-faire-évoluer-des-builds" data-background-color="#02303A"><h2>Maintenir et faire évoluer des builds</h2></section><section id="maintenir-et-faire-évoluer-des-builds-2"><h2>Maintenir et faire évoluer des builds</h2><div class="ulist"><ul><li><p>You want tests!</p></li><li><p>Progressive refactoring towards best practices</p></li><li><p>Groovy vs. Kotlin</p></li></ul></div></section></section>
<section><section id="intégration-continue-2" data-background-color="#02303A"><h2>Intégration continue</h2></section><section id="intégration-continue-3"><h2>Intégration continue</h2><div class="ulist"><ul><li><p>ne désactivez pas le démon Gradle</p></li><li><p>agents éphemères == pas de démon</p></li><li><p>ne partagez pas <code>~.gradle/caches</code>, utilisez plutôt un repo</p></li></ul></div></section></section>
<section id="en-résumé" data-background-color="#02303A"><h2>En résumé</h2><div class="ulist"><ul><li><p>le build ce n&#8217;est pas sale</p></li><li><p>le build ce n&#8217;est pas sale</p></li><li><p>le build ce n&#8217;est pas sale</p></li></ul></div></section>
<section id="en-résumé-2" data-transition="none" data-background-color="#02303A"><h2>En résumé</h2><div class="ulist"><ul><li><p>le build c&#8217;est de l&#8217;automatisation</p></li><li><p>et l&#8217;automatisation c&#8217;est la vie (de développeur)</p></li><li><p>tout comme pour le code de production, il faut</p><div class="ulist"><ul><li><p>connaître ses outils</p></li><li><p>tester</p></li><li><p>maintenir</p></li></ul></div></li><li><p><strong>Gradle c&#8217;est bien™</strong></p></li></ul></div></section>
<section id="questions" data-background-color="#02303A"><h2>Questions</h2><div class="dlist"><dl><dt class="hdlist1">Gradle</dt><dd><p><a href="https://gradle.org/">gradle.org</a></p></dd><dt class="hdlist1">Slides</dt><dd><p><a href="https://eskatos.github.io/jug-montpellier-gradle-best-practices">eskatos.github.io/jug-montpellier-gradle-best-practices</a></p></dd><dt class="hdlist1">Documentation</dt><dd><p><a href="https://docs.gradle.org/">docs.gradle.org</a></p></dd><dt class="hdlist1">Performance guide</dt><dd><p><a href="https://guides.gradle.org/performance">guides.gradle.org/performance</a></p></dd><dt class="hdlist1">Slack</dt><dd><p><a href="https://join.slack.com/t/gradle-community/shared_invite/enQtNDE3MzAwNjkxMzY0LTYwMTk0MWUwN2FiMzIzOWM3MzBjYjMxNWYzMDE1NGIwOTJkMTQ2NDEzOGM2OWIzNmU1ZTk5MjVhYjFhMTI3MmE">lien d&#8217;invitation</a></p></dd><dt class="hdlist1">On recrute !</dt><dd><p><a href="https://gradle.com/careers/">gradle.com/careers</a></p></dd></dl></div></section>
<section id="merci" data-background-image="./images/outro.jpeg"></section></div></div><script src="reveal.js/lib/js/head.min.js"></script><script src="reveal.js/js/reveal.js"></script><script>Array.prototype.slice.call(document.querySelectorAll('.slides section')).forEach(function(slide) {
  if (slide.getAttribute('data-background-color')) return;
  // user needs to explicitly say he wants CSS color to override otherwise we might break custom css or theme (#226)
  if (!(slide.classList.contains('canvas') || slide.classList.contains('background'))) return;
  var bgColor = getComputedStyle(slide).backgroundColor;
  if (bgColor !== 'rgba(0, 0, 0, 0)' && bgColor !== 'transparent') {
    slide.setAttribute('data-background-color', bgColor);
    slide.style.backgroundColor = 'transparent';
  }
})

// See https://github.com/hakimel/reveal.js#configuration for a full list of configuration options
Reveal.initialize({
  // Display presentation control arrows
  controls: true,
  // Help the user learn the controls by providing hints, for example by
  // bouncing the down arrow when they first encounter a vertical slide
  controlsTutorial: true,
  // Determines where controls appear, "edges" or "bottom-right"
  controlsLayout: 'bottom-right',
  // Visibility rule for backwards navigation arrows; "faded", "hidden"
  // or "visible"
  controlsBackArrows: 'faded',
  // Display a presentation progress bar
  progress: true,
  // Display the page number of the current slide
  slideNumber: 'true',
  // Control which views the slide number displays on
  showSlideNumber: 'all',
  // Push each slide change to the browser history
  history: true,
  // Enable keyboard shortcuts for navigation
  keyboard: true,
  // Enable the slide overview mode
  overview: true,
  // Vertical centering of slides
  center: true,
  // Enables touch navigation on devices with touch input
  touch: true,
  // Loop the presentation
  loop: false,
  // Change the presentation direction to be RTL
  rtl: false,
  // Randomizes the order of slides each time the presentation loads
  shuffle: false,
  // Turns fragments on and off globally
  fragments: true,
  // Flags whether to include the current fragment in the URL,
  // so that reloading brings you to the same fragment position
  fragmentInURL: false,
  // Flags if the presentation is running in an embedded mode,
  // i.e. contained within a limited portion of the screen
  embedded: false,
  // Flags if we should show a help overlay when the questionmark
  // key is pressed
  help: true,
  // Flags if speaker notes should be visible to all viewers
  showNotes: false,
  // Global override for autolaying embedded media (video/audio/iframe)
  // - null: Media will only autoplay if data-autoplay is present
  // - true: All media will autoplay, regardless of individual setting
  // - false: No media will autoplay, regardless of individual setting
  autoPlayMedia: null,
  // Number of milliseconds between automatically proceeding to the
  // next slide, disabled when set to 0, this value can be overwritten
  // by using a data-autoslide attribute on your slides
  autoSlide: 0,
  // Stop auto-sliding after user input
  autoSlideStoppable: true,
  // Use this method for navigation when auto-sliding
  autoSlideMethod: Reveal.navigateNext,
  // Specify the average time in seconds that you think you will spend
  // presenting each slide. This is used to show a pacing timer in the
  // speaker view
  defaultTiming: 120,
  // Enable slide navigation via mouse wheel
  mouseWheel: false,
  // Hides the address bar on mobile devices
  hideAddressBar: true,
  // Opens links in an iframe preview overlay
  // Add `data-preview-link` and `data-preview-link="false"` to customise each link
  // individually
  previewLinks: false,
  // Transition style (e.g., none, fade, slide, convex, concave, zoom)
  transition: 'linear',
  // Transition speed (e.g., default, fast, slow)
  transitionSpeed: 'default',
  // Transition style for full page slide backgrounds (e.g., none, fade, slide, convex, concave, zoom)
  backgroundTransition: 'fade',
  // Number of slides away from the current that are visible
  viewDistance: 3,
  // Parallax background image (e.g., "'https://s3.amazonaws.com/hakim-static/reveal-js/reveal-parallax-1.jpg'")
  parallaxBackgroundImage: '',
  // Parallax background size in CSS syntax (e.g., "2100px 900px")
  parallaxBackgroundSize: '',
  // Number of pixels to move the parallax background per slide
  // - Calculated automatically unless specified
  // - Set to 0 to disable movement along an axis
  parallaxBackgroundHorizontal: null,
  parallaxBackgroundVertical: null,
  // The display mode that will be used to show slides
  display: 'block',

  // The "normal" size of the presentation, aspect ratio will be preserved
  // when the presentation is scaled to fit different resolutions. Can be
  // specified using percentage units.
  width: 960,
  height: 700,

  // Factor of the display size that should remain empty around the content
  margin: 0.1,

  // Bounds for smallest/largest possible scale to apply to content
  minScale: 0.2,
  maxScale: 1.5,

  // Optional libraries used to extend on reveal.js
  dependencies: [
      { src: 'reveal.js/lib/js/classList.js', condition: function() { return !document.body.classList; } },
      { src: 'reveal.js/plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
      { src: 'reveal.js/plugin/zoom-js/zoom.js', async: true },
      { src: 'reveal.js/plugin/notes/notes.js', async: true },
      
      
      
      
  ],

  

});</script><!-- this currently shows up at the wrong location in the final index.html which means the style font is not properly applied-->

<div class="footer">
    <!--p>Montpellier JUG - 20 Mars 2019</p-->
</div></body></html>